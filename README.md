# ADISE25_kotopla
Table of Contents
=================
   * [Εγκατάσταση](#εγκατάσταση)
      * [Απαιτήσεις](#απαιτήσεις)
      * [Οδηγίες Εγκατάστασης](#οδηγίες-εγκατάστασης)
      * [Περιγραφή Παιχνιδιού](#Περιγραφή-Παιχνιδιού)
   * [Περιγραφή API](#περιγραφή-api)
      * [Methods](#methods)
         * [Board](#board)
            * [Ανάγνωση Board](#ανάγνωση-board)
            * [Αρχικοποίηση Board](#αρχικοποίηση-board)
            * [Επαναφορά Board](#Επαναφορά-Board)
         * [Piece](#piece)
            * [Ανάγνωση Θέσης/Πιονιού](#ανάγνωση-θέσηςπιονιού)
            * [Μεταβολή Θέσης Πιονιού](#μεταβολή-θέσης-πιονιού)
         * [Player](#player)
            * [Ανάγνωση στοιχείων παίκτη](#ανάγνωση-στοιχείων-παίκτη)
            * [Καθορισμός στοιχείων παίκτη](#καθορισμός-στοιχείων-παίκτη)
         * [Status](#status)
            * [Ανάγνωση κατάστασης παιχνιδιού](#ανάγνωση-κατάστασης-παιχνιδιού)
         * [game](#game)
            * [Ρίψη Ζαριών](#Ρίψη-ζαρίων)
            * [Αλλαγή Σειράς](#Αλλαγή-σειράς)
      * [Entities](#entities)
         * [Board](#board-1)
         * [Players](#players)
         * [Game_status](#game_status)
         * [Stack](#stack)
         * [Move Piece](#move_piece)
         * [Change Turn](#change_turn)
         * [Reset Game](#reset_game)
         * [Restart Game](#restart_game)

# Demo Page

Μπορείτε να κατεβάσετε τοπικά ή να επισκευτείτε την σελίδα: 
https://users.iee.ihu.gr/~iee2019160/plakwto/


# Εγκατάσταση

## Απαιτήσεις

* Apache2
* Mysql Server / MariaDB
* php

## Οδηγίες Εγκατάστασης

 * Κάντε clone το project σε κάποιον φάκελο <br/>
  `$ git clone https://github.com/iee-ihu-gr-course1941/ADISE25_kotopla.git`


 * Βεβαιωθείτε ότι ο φάκελος είναι προσβάσιμος από τον Apache Server. πιθανόν να χρειαστεί να καθορίσετε τις παρακάτω ρυθμίσεις.

 * Θα πρέπει να δημιουργήσετε στην Mysql την βάση με όνομα 'tavli' και να φορτώσετε σε αυτήν την βάση τα δεδομένα από το αρχείο db_schema.sql

 * Θα πρέπει να φτιάξετε το αρχείο lib/db_credentials.php το οποίο να περιέχει:
```
    <?php
	$DB_PASS = 'κωδικός';
	$DB_USER = 'όνομα χρήστη';
    ?>
```

# Περιγραφή Παιχνιδιού

Το τάβλι πλακωτό παίζεται ως εξής: οι 2 παίχτες ξεκινάνε απο την δεξιά πλευρά του ταμπλού απέναντι ο ένας απο τον άλλον, υπάρχουν 15
πούλια για κάθε παίχτη τα οποία τοποθετούνται στην δεξιότερη στήλη της αφετηρίας κάθε παίχτη στοιβαγμένα όλα μαζί.Σκοπός του παιχνιδιού 
είναι να μεταφέρεις όλα τα πούλια σου στην αφετηρία του αντιπάλου σου και μετά να τα μαζέψεις πρώτος.

Οι κανόνες είναι οι εξής : 
Στήσιμο:
ο παίχτης που ξεκινάει στην κάτω πλευρά του ταμπλού κινείται αριστερόστροφα ενω ο παίχτης στην πάνω πλευρά 
δεξιόστροφα, η αρχική σειρά παιξίματος δηλαδή το ποίος παίχτης θα παίξει πρώτος καθορίζεται απο τους παίχτες ρίχνοντας 2 ζάρια και όποιος φέρει την μεγαλύτερη σε άθροισμα ζαριά παίζει πρώτος, στην εφαρμογή μας αυτό γίνεται εσωτερικά με 50-50% πιθανότητα να ξεκινήσει είτε ο λευκός είτε ο μαύρος παίχτης πρώτος ,χωρίς όμως να φαίνεται στον χρήστη.

Κινήσεις :
ο παίχτης ρίχνει ζαριά και μπορει να κουνήσει με βάση την ζαρία του όποιο πούλι/α θέλει σε οποιαδήποτε θέση που βρίσκεται τόσες στήλες όσο και οι αριθμοί της ζαριάς του σε απόσταση απο την στήλη οπου επέλεξε ενα πούλι για κίνηση (πάντα απο μιά επιλεγμένη στήλη κουνιέται το επάνω πούλι της στοίβας). Ακουλουθούνται πάντα οι αντίστοιχες φορές κίνησης κάθε παίχτη.Αν κάποιος παίχτης φέρει 'διπλή' ζαρία δηλαδή 2 ίδιους αριθμούς πχ 6-6 , τότε μπορεί να παίξει 4 φορές τον αριθμό της ζαριάς, δηλαδη παίζει 4 φορες 6.Αν υπάρχει κάποιο πούλι πλακωμένο απο εσάς τότε ο αντίπαλος δεν μπορέι να μετακινήσει τα δικά του πούλια στην στήλη αυτήν, το ίδιο ισχύει εάν σε μία στήλη υπάρχουν 2 η περισσότερα πούλια του ιδίου χρώματος.

Πλάκωμα:
Εάν ένα πούλι βρίσκεται μόνο του σε μία στήλη τότε ο αντίπαλος παίχτης μπορεί να το 'πλακώσει' δηλαδή να βάλει ενα δικό του πούλι πάνω απο του αντιπάλου.Τα πλακωμένα πούλια δεν μπορούν να κουνηθούν μέχρι ο αντίπαλος να κουνήσει ολα τα δικα τού πούλια που βρίσκονται απο πάνω του.

Μάζεμα :
Εάν ένας παίχτης έχει μεταφέρει όλα τα πούλια του στην περιοχή του αντιπάλου τότε οι ζαριές που ρίχνει του επιτρέπουν να μαζέυει πούλια απο τις αντίστοιχες αριθμημένες στήλης της αφετηρίας του αντιπάλου, η αριστερότερη στήλη έχει τον αριθμό 6 και η δεξιότερη τον αριθμό 1.Σε περίπτωση που κάποιος αριθμός απο μία ζαρία δενν έχει κανένα πούλι στην αντίστοιχη στήλη τότε μαζέυουμε τον αμέσως μικρότερο πχ αν φέρω 6-4 αλλά στην στήλη 6 δεν υπάρχει κανένα πούλι τότε με το 6 μπορώ να μαζέψω απο την στήλη 5.Επιπλέον επιτρέπεται αντί για μάζεμα να γινουν και κινήσεις μέσα στην περιοχή μαζέματος ανάλογα με την ζαριά. Αν ενας παίχτης εχει μεταφέρει ολα τα πούλια του για μάζεμα αλλα ο αντίπαλος τον έχει πλακώσει μεσα στην περιοχή μαζέματος τοτε πρέπει να κάνει μόνο κινήσεις μεχρι να τον ελευθερώσει ο αντίπαλος για να μπορέσει να αρχίσει το μάζεμα.

Νίκη :
ο παίχτης που θα μαζέψει πρώτος όλα τα πούλια του ανταμοίβεται με έναν πόντο, νικητής είναι όποιος έχει τους περισσότερους πόντους στο τέλους του παιχνιδιού, αυτό ορίζεται απο τους χρήστες.

## BUGS
Το παιχνίδι είναι πλήρως λειτουργικό, ακολουθεί τα λογικά πλαίσια και τους κανόνες που έχουμε ορίσει, παρόλα αυτά παρουσιάζει μερικά περιστασιακά bugs τα οποία συναντήσαμε καθώς παίζαμε και κάναμε τις διάφορες δοκιμές λειτουργίας. 

1) Υπάρχει μια μικρή πιθανότητα να μην γίνει μετά η αυτόματη αλλαγή σειράς την δεύτερη (ή τέταρτη, στις διπλές) κίνηση , κάτι που όμως δεν χαλάει την ροή του παιχνιδιού καθώς υπάρχει ενεργό timer στον παίκτη ο οποίος παίζει εκείνη τη στιγμή το οποίο μόλις γίνει 0 αλλάζει αυτόματα η σειρά.

2) Σε ορισμένες περιπτώσεις μπορεί να μην εμφανιστεί κάποιο μήνυμα ενημέρωσης σε έναν από τους 2 παίκτες παρόλο που το action μπορεί να έχει γίνει, ασχέτως αυτού τα δεδομένα αποστέλλονται κανονικά και οι ενημερώσεις των κινήσεων και του σκορ πραγματοποιούνται ορθά.

3) Υπάρχει το ενδεχόμενο, να χαθεί κάποιο από τα 2 ζάρια του παίκτη που παίζει εκείνη την στιγμή, ωστόσο αυτό αποτέλεσε ένα ιδιαίτερα σπάνιο bug το οποίο παρατηρήσαμε μόνο μία φορά.
## Συντελεστές


Συγγιρίδης Δημήτριος 2019160: Jquerry,JS,PHP API,SQL,CSS

Λεωνίδας Αποστολίδης 2019007: Jquerry,JS,PHP API,SQL,CSS

Στέλιος Τριανταφυλλίδης 2019171: JS,jquerry


# Περιγραφή API

## Methods


### Board
#### Ανάγνωση Board

```
GET /board/
```

Επιστρέφει το [Board](#Board).

#### Αρχικοποίηση Board
```
POST /board/
```

Αρχικοποιεί το Board, δηλαδή το παιχνίδι. Γίνονται reset τα πάντα σε σχέση με το παιχνίδι(usernames,score,board).
Επιστρέφει το [Board](#Board-1).χρειάζεται refresh για να φανούν οι αλλαγές

#### Επαναφορά Board
```
PUT /board/
```

Αρχικοποιεί το Board, δηλαδή το παιχνίδι. Γίνεται reset μόνο το ταμπλό(board).
Επιστρέφει το [Board](#Board-2).Δεν χρειάζεται refresh για να φανούν οι αλλαγές.

### Piece
#### Ανάγνωση Θέσης/Πιονιού

```
GET /board/piece/:x/:y/
```
επιστρέφει τα περιεχόμενα μιας στόιβας του board

| Stack           | piece_color  | piece_index | Required   |
| ----------------- | -------------| ---------- | ----------  |
| `x`               |     W        |    1       |    yes      |
| `y`               |     W        |    2       |    yes      |
...
...
#### Μεταβολή Θέσης Πιονιού

```
PUT /board/piece/:x/:y/
```
Κάνει την κίνηση του πιονιού από την θέση x,y στην νέα θέση.Eλέγχεται εάν η κίνηση αν είναι νόμιμη καθώς και αν είναι η σειρά του παίκτη να παίξει με βάση το token και το p_turn.
Επιστρέφει τα στοιχεία από το [Board](#Board-1) με συντεταγμένες x,y.
Περιλαμβάνει το χρώμα του πιονιού.
Json Data στο body:

| Field             | Description                 | Required   |
| ----------------- | --------------------------- | ---------- |
| `x`               | Η νέα θέση x                | yes        |
| `y`               | Η νέα θέση y                | yes        |

Επιστρέφει τα στοιχεία από το [Board](#Board-1) με συντεταγμένες x,y.
Περιλαμβάνει το χρώμα του πιονιού και τον τύπο


### Player

#### Ανάγνωση στοιχείων παίκτη
```
GET /players/:p
```

Επιστρέφει τα στοιχεία του παίκτη p ή όλων των παικτών αν παραληφθεί. Το p μπορεί να είναι 'B' ή 'W'.

#### Καθορισμός στοιχείων παίκτη
```
PUT /players/:p
```
Json Data στο body:

| Field             | Description                 | Required   |
| ----------------- | --------------------------- | ---------- |
| `username`        | Το username για τον παίκτη p. | yes        |
| `color`           | To χρώμα που επέλεξε ο παίκτης p. | yes        |


Επιστρέφει τα στοιχεία του παίκτη p και ένα token. Το token πρέπει να το χρησιμοποιεί ο παίκτης καθόλη τη διάρκεια του παιχνιδιού.

### Status

#### Ανάγνωση κατάστασης παιχνιδιού
```
GET /status/
```

Επιστρέφει το στοιχείο [Game_status](#Game_status).

### game

#### Ρίψη ζαρίων
```
POST /game/roll
```
Ρίχνει τα ζάρια για τον παίχτη όπου έχει σειρά και επιστρέφει σε JSON τις τιμές,μπορεί να φέρει και διπλές.Εμφανίζει και ανάλογα μυνήματα σε περιπτώσεις λάθους.

{
    "d1": 3,
    "d2": 1
}

#### Αλλαγή σειράς
```
POST /game/change_turn
```
Αλλάζει την σείρα παιξίματος , αν παίζει ο B τότε η σειρά θα πάει στον W.(γενικά η αλλαγή σειράς γίνεται μέσω της κίνησης το συγκεκριμένο endpoint χρησιμοποιείται για αλλαγή σειράς όταν δέν μπορεί να γίνει κίνηση).Δεν επιστρέφει τίποτα απλά εκτελεί μια μέθοδο για αλλαγή σειράς στην βάση.


## Entities

----Tables----

-board(row,col)
-players(username,piece_color,token,last_action)
-game_status(status,p_turn,last_change,move_1,move_2,move_3,move_4,score_w,score_b)
-stack(row,col,piece_index,piece_color)

----Procedures----

-move_piece(procedure)
-change_turn(procedure)
-reset_game(procedure)
-restart_game(procedure)


### Board
---------

Το board είναι ένας πίνακας, ο οποίος στο κάθε στοιχείο έχει τα παρακάτω:


| Attribute                | Description                                  | Values                              |
| ------------------------ | -------------------------------------------- | ----------------------------------- |
| `row`                      | H συντεταγμένη x του τετραγώνου            | 1..2                                |
| `column`                      | H συντεταγμένη y του τετραγώνου         | 1..12                               |

### Players
---------

O κάθε παίκτης έχει τα παρακάτω στοιχεία:


| Attribute                | Description                                  | Values                              |
| ------------------------ | -------------------------------------------- | ----------------------------------- |
| `username`               | Όνομα παίκτη                                 | String                              |
| `piece_color`            | To χρώμα που παίζει ο παίκτης                | 'B','W'                             |
| `token  `                | To κρυφό token του παίκτη. Επιστρέφεται μόνο τη στιγμή της εισόδου του παίκτη στο παιχνίδι | HEX |
| `last_action`            | Τελευταία αλλαγή/ενέργεια στην κατάσταση του παιχνιδιού                | timestamp |

### Game_status
---------

H κατάσταση παιχνιδιού έχει τα παρακάτω στοιχεία:


| Attribute                | Description                                  | Values                              |
| ------------------------ | -------------------------------------------- | ----------------------------------- |
| `status  `               | Κατάσταση             | 'not active', 'initialized', 'started', 'ended', 'aborded' |
| `p_turn`                 | To χρώμα του παίκτη που παίζει        | 'B','W',null                               |
| `last_change`            | Τελευταία αλλαγή/ενέργεια στην κατάσταση του παιχνιδιού                | timestamp |
| `move_1`                 | Η 1η κίνηση ανάλογα με την ζαριά                                       | 1..6      |
| `move_2`                 | Η 2η κίνηση ανάλογα με την ζαριά                                       | 1..6      |
| `move_3`                 | Η 3η κίνηση ανάλογα με την ζαριά (μόνο σε διπλές)                      | 1..6      |
| `move_4`                 | Η 4η κίνηση ανάλογα με την ζαριά (μόνο σε διπλές)                      | 1..6      |
| `score_w`                | Το σκορ του παίκτη με τα Λευκά                                         | 0..255    |
| `score_b`                | Τελευταία αλλαγή/ενέργεια στην κατάσταση του παιχνιδιού                | 0..255    |


#### Stack
---------

Το stack είναι ένας πίνακας, ο οποίος στο κάθε στοιχείο έχει τα παρακάτω:


| Attribute                | Description                                  | Values                              |
| ------------------------ | -------------------------------------------- | ----------------------------------- |
| `row`                      | H συντεταγμένη x του τετραγώνου            | 1..2                                |
| `column`                      | H συντεταγμένη y του τετραγώνου         | 1..12                               |
| `piece_index`            | Ο αριθμός των πουλιών στην στήλη             | 1..15                               |
| `piece_color`            | Το χρώμα του πουλιού                         |'B,'W'                               |

### Move_piece

Λειτουργία: Είναι η κεντρική λογική της κίνησης.

-Ελέγχει αν είναι η σειρά του παίκτη.
-Ελέγχει αν η κίνηση είναι μάζεμα (bearing off) ή κανονική μετακίνηση.
-Επαληθεύει αν υπάρχει διαθέσιμο ζάρι για την απόσταση που ζητήθηκε.
-Εκτελεί την κίνηση (UPDATE) ή τη διαγραφή (DELETE) του πιονιού.
-"Καίει" το χρησιμοποιημένο ζάρι και αν τελειώσουν όλα τα ζάρια, αλλάζει αυτόματα τη σειρά.

### Change_turn

Λειτουργία: Αλλάζει τη σειρά του παίκτη (αν παίζει ο 'W' το γυρίζει σε 'B' και αντίστροφα) και μηδενίζει (κάνει NULL) όλες τις τιμές των ζαριών στον πίνακα game_status.

-Χρησιμοποιείται όταν ένας παίκτης δεν έχει άλλες κινήσεις ή πατάει πάσο.

### Reset_game

Λειτουργία (Hard Reset): Επαναφέρει το παιχνίδι στην απόλυτη αρχή.

-Διαγράφει όλα τα πούλια και τα ξαναστήνει στην αρχική διάταξη του Πλακωτού.
-Διαγράφει τους παίκτες (κάνει NULL τα username, token), ουσιαστικά αποσυνδέοντάς τους από το τραπέζι.
-Μηδενίζει τα ζάρια.

### Restart_game

Λειτουργία (Soft Reset): Ετοιμάζει το ταμπλό για νέο γύρο/παρτίδα.

-Διαγράφει όλα τα πούλια και τα ξαναστήνει στην αρχική διάταξη.
-Μηδενίζει τα ζάρια.
-ΔΕΝ διαγράφει τους παίκτες, επιτρέποντάς τους να συνεχίσουν να παίζουν την επόμενη παρτίδα με τα ίδια tokens/ονόματα.

